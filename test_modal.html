<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üîç Test de Modal de Documentos</h1>
        
        <div class="row">
            <div class="col-md-12">
                <h3>Documentos de Prueba</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1</td><td>test_factura.pdf</td><td><button class="btn btn-sm btn-primary" onclick="testModal(1)">Ver Detalles</button></td></tr>
                        <tr><td>4</td><td>Factura A 00002 00000556 - Edp Agroindustrial S.A..pdf</td><td><button class="btn btn-sm btn-primary" onclick="testModal(4)">Ver Detalles</button></td></tr>
                        <tr><td>6</td><td>FA-A 00005-00003211.pdf</td><td><button class="btn btn-sm btn-primary" onclick="testModal(6)">Ver Detalles</button></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="testModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalles del Documento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modal-content">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function testModal(documentId) {
            console.log('üîç Testing modal for document ID:', documentId);
            
            // Mostrar modal con loading
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2">Cargando documento ID: ${documentId}...</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('testModal'));
            modal.show();
            
            try {
                const response = await fetch(`http://localhost:8001/api/documents/${documentId}`);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const document = await response.json();
                console.log('Document received:', document);
                
                // Actualizar contenido
                modalContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informaci√≥n General</h6>
                            <table class="table table-sm">
                                <tr><td><strong>ID:</strong></td><td>${document.id}</td></tr>
                                <tr><td><strong>Archivo:</strong></td><td>${document.filename}</td></tr>
                                <tr><td><strong>Tipo:</strong></td><td><span class="badge bg-primary">${document.tipo}</span></td></tr>
                                <tr><td><strong>CUIT:</strong></td><td>${document.cuit || 'N/A'}</td></tr>
                                <tr><td><strong>Proveedor:</strong></td><td>${document.proveedor || 'N/A'}</td></tr>
                                <tr><td><strong>Confianza:</strong></td><td>${document.confidence ? (document.confidence * 100).toFixed(2) + '%' : 'N/A'}</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Detalles de Clasificaci√≥n</h6>
                            <div class="bg-light p-3 rounded" style="max-height: 300px; overflow-y: auto;">
                                ${document.detalles_clasificacion ? 
                                    `<pre class="small">${JSON.stringify(document.detalles_clasificacion, null, 2)}</pre>` :
                                    '<p class="text-muted">No disponible</p>'
                                }
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                modalContent.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>Error cargando documento</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>